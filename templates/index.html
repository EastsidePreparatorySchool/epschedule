<!doctype html>
<html>
  <head>
    <title>EPSchedule{% if admin%} Admin{% endif %}</title>
    <meta charset="utf=8" />
    <meta
      name="viewport"
      content="width=device-width, minimum-scale=1.0, initial-scale=1.0"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/static/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/static/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/static/favicon/favicon-16x16.png"
    />
    <link rel="manifest" href="/static/favicon/site.webmanifest" />
    <script src="https://epschedule-static.storage.googleapis.com/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <script
      src="https://kit.fontawesome.com/a076d05399.js"
      crossorigin="anonymous"
    ></script>
    <!-- gets icons -->
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/polymer/polymer.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/font-roboto/roboto.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/iron-flex-layout/iron-flex-layout.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/iron-icons/iron-icons.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/iron-pages/iron-pages.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/iron-image/iron-image.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/neon-animation/neon-animated-pages.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/neon-animation/neon-animations.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/paper-button/paper-button.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/paper-dialog/paper-dialog.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/paper-drawer-panel/paper-drawer-panel.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/paper-header-panel/paper-header-panel.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/paper-icon-button/paper-icon-button.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/paper-item/paper-icon-item.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/paper-input/paper-input.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/paper-toast/paper-toast.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/paper-toolbar/paper-toolbar.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/paper-typeahead-input/paper-typeahead-input.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/paper-toggle-button/paper-toggle-button.html"
    />
    <link
      rel="import"
      href="https://epschedule-static.storage.googleapis.com/bower_components/iron-icons/image-icons.html"
    />
    <!-- special-case this one icon from the action set -->
    <iron-iconset-svg name="action" size="24">
      <svg>
        <defs>
          <g id="calendar">
            <path d="M0 0h24v24H0z" fill="none" />
            <path
              d="M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V8h16v13z"
            />
          </g>
        </defs>
      </svg>
    </iron-iconset-svg>
    <iron-iconset-svg name="custom" size="24">
      <svg>
        <defs>
          <g id="trimester">
            <path d="M2 4l6 8-6 8M10 4l6 8-6 8" />
          </g>
        </defs>
      </svg>
    </iron-iconset-svg>
    <link rel="import" href="static/html/schedule.html" />
    <link rel="import" href="static/html/schedule_lite.html" />
    <link rel="stylesheet" href="static/css/index.css" />
    <script>
      var userSchedule = {{ schedule | safe }};
      var days = {{days | safe }};
      var lunches = {{lunches | safe}};
      var termStarts = {{ term_starts | safe}};
      var latestCommits = {{ latest_commits | safe}};
      var triStartDates = [];
      for (var i = 0; i < 3; i++) {
          triStartDates.push(new Date(termStarts[i]));
      }
    </script>
    <script src="static/js/index.js"></script>
  </head>
  <body unresolved="">
    <span style="display: none !important" id="namefjs">{{username}}</span>
    <neon-animated-pages id="pages" selected="0">
      <paper-drawer-panel id="drawerpanel" force-narrow>
        <paper-header-panel id="drawerheader" drawer>
          <paper-toolbar>
            <span class="title">EPSchedule</span>
          </paper-toolbar>
          <div>
            <div class="image-container">
              <img src="static/images/epslogo.jpg" />
            </div>
            <paper-icon-item class="side-panel-boxes" onclick="signOut()" noink>
              <iron-icon class="drawer-icon" icon="account-circle" item-icon>
              </iron-icon>
              <span class="side-panel-buttons">Sign out</span>
            </paper-icon-item>
            <paper-icon-item
              class="side-panel-boxes"
              onclick="openSettings()"
              noink
            >
              <iron-icon class="drawer-icon" icon="settings" item-icon>
              </iron-icon>
              <span class="side-panel-buttons">Settings</span>
            </paper-icon-item>
            <paper-icon-item
              class="side-panel-boxes"
              onclick="reportBug()"
              noink
            >
              <iron-icon class="drawer-icon" icon="bug-report" item-icon>
              </iron-icon>
              <span class="side-panel-buttons">Report a bug</span>
            </paper-icon-item>
            <paper-icon-item
              class="side-panel-boxes"
              onclick="githubDisplay()"
              noink
            >
              <iron-icon class="drawer-icon" icon="description" item-icon>
              </iron-icon>
              <span class="side-panel-buttons">See Latest Changes</span>
            </paper-icon-item>
            <paper-icon-item class="side-panel-boxes" onclick="about()" noink>
              <iron-icon class="drawer-icon" icon="info" item-icon> </iron-icon>
              <span class="side-panel-buttons">About</span>
            </paper-icon-item>
            <paper-icon-item
              class="side-panel-boxes"
              onclick="changePhoto()"
              noink
            >
              <iron-icon class="drawer-icon" icon="image:photo" item-icon>
              </iron-icon>
              <span class="side-panel-buttons">Change Photo</span>
            </paper-icon-item>

            <p
              style="
                position: absolute;
                bottom: 0;
                left: 0;
                padding-left: 20px;
                color: gray;
              "
            >
              v{{version}}
            </p>
          </div>
        </paper-header-panel>
        <paper-header-panel id="mainheader" main>
          <paper-toolbar class="headerbar">
            <neon-animated-pages class="headerbarpages" selected="0">
              <div class="headerbarpage mainheader">
                <paper-icon-button class="" icon="menu" paper-drawer-toggle>
                </paper-icon-button>
                <span class="title" id="day">Today</span>
                <button
                  onclick="window.open('https://forms.microsoft.com/r/sEqxAVt4PB')"
                  class="join-button"
                >
                  Join Hack Club
                </button>
                <!-- Draw our calendar icon on top of the native picker -->
                <span class="datepicker-toggle">
                  <span class="datepicker-toggle-button">
                    <iron-icon icon="action:calendar"></iron-icon>
                  </span>
                  <input
                    class="datepicker-input"
                    type="date"
                    id="date"
                    onchange="selectDate()"
                  />
                </span>
                <paper-icon-button
                  class="rightfloat"
                  icon="arrow-back"
                  onclick="dateBack()"
                >
                </paper-icon-button>
                <paper-icon-button
                  class="rightfloat"
                  icon="arrow-forward"
                  onclick="dateForward()"
                >
                </paper-icon-button>
                <div class="tooltip">
                  <span class="tooltiptext">Skip to Next Trimester</span>
                  <paper-icon-button
                    class="rightfloat"
                    icon="custom:trimester"
                    onclick="dateToNextTri()"
                  >
                  </paper-icon-button>
                </div>
                <paper-icon-button
                  class="rightfloat"
                  icon="search"
                  onclick="openSearchBar()"
                >
                </paper-icon-button>
              </div>
              <div class="headerbarpage searchbackground">
                <paper-icon-button
                  class="grey"
                  icon="arrow-back"
                  onclick="closeSearchBar()"
                >
                </paper-icon-button>
                <paper-typeahead-input
                  max-suggestions="5"
                  placeholder="Search people"
                  remote-url="/search/%QUERY"
                  remote-url-wait-ms="100"
                  is-candidates-json
                  display-prop="name"
                >
                </paper-typeahead-input>
              </div>
            </neon-animated-pages>
          </paper-toolbar>
          <div id="container" class="container" layout="" vertical="" center="">
            <x-schedule id="mainschedule" show="all"></x-schedule>
          </div>
        </paper-header-panel>
      </paper-drawer-panel>
      <paper-header-panel id="popup">
        <div class="popupcontainerholder" id="popupContainerHolder">
          <paper-toolbar>
            <paper-icon-button icon="arrow-back" onclick="closePopup()">
            </paper-icon-button>
            <span id="popupTitle" class="title"></span>
          </paper-toolbar>
          <div id="popupContainer" layout="" vertical="" center=""></div>
        </div>
      </paper-header-panel>
    </neon-animated-pages>

    <paper-dialog class="about-dialog" id="about">
      <div id="aboutpanel">
        <h2>About</h2>
        <div>
          EPSchedule Club:
          <p>---A club designated to maintain this website and add changes</p>
          <p>---We meet in TMAC-007, every Thursday during Middle Band</p>
        </div>

        <div>
          Club Leaders: Anmol Josan and Rishi Pudipeddi:
          <a href="mailto:ajosan@eastsideprep.org">ajosan@eastsideprep.org</a>
          <a href="mailto:rpudipeddi@eastsideprep.org"
            >rpudipeddi@eastsideprep.org</a
          >
          <p>---Club leaders and managers of this project</p>
          <p>---Made everyone's photos visible</p>
        </div>

        <div>
          Connor West:
          <a href="mailto:cwest@eastsideprep.org">cwest@eastsideprep.org</a>
          <p>---fixed the website</p>
          <p>---gave freedom to those who wanted to hide their photos</p>
        </div>
      </div>
    </paper-dialog>

    <paper-dialog class="github-dialog" id="Github">
      <div id="GithubUpdateBox" class="GithubUpdateBox">
        <h1>
          <a
            class="GithubTitleA"
            href="https://github.com/EastsidePreparatorySchool/epschedule"
          >
            Latest Github Updates
          </a>
        </h1>
        <div id="GHUpdateText"></div>
        <br />
      </div>
    </paper-dialog>

    <paper-dialog class="dialog" id="changephoto">
      <div id="current_pic"></div>
      <form id="photochangeform">
        <label for="fileInput">Upload a file (Max: 10 MB):</label>
        <br />
        <input
          class="photo-upload-button"
          type="file"
          id="fileInput"
          accept="image/png,image/jpeg,image/jfif,image/webp"
          required
        /><br />
        <button class="join-button" type="submit">Change photo</button>
        <p>
          Note that your photo will be manually reviewed before being changed.
          It must be school-appropriate and be a photo of you.
        </p>
      </form>
    </paper-dialog>

    <paper-dialog class="dialog" id="dialog">
      <div id="settingspanel">
        <h2 class="settingstitle">Settings</h2>
        <div class="settingsdividerline"></div>
        <h3 class="privacypaneltitle">Privacy</h3>
        <div class="inlinesettingsswitch">
          <span id="privtext1" class="leftfloat padleft"
            >Show other EPS students my photo</span
          >
          <paper-toggle-button class="rightfloat" id="sharephototoggle">
          </paper-toggle-button>
          <span id="privtext2" class=""
            ><br />Note that you will still be able to see your own photo</span
          >
        </div>
        <paper-button
          onclick="submitUpdatePrivacy()"
          raised
          class="settingsbutton"
          id="updatesettings"
        >
          OK
        </paper-button>
      </div>
    </paper-dialog>
    <paper-toast id="toast" text="" duration="10000"></paper-toast>
    <script>
      document.getElementById("sharephototoggle").checked={{share_photo}};
    </script>
    <script>
      // Runs Google Analytics
      (function (i, s, o, g, r, a, m) {
        i["GoogleAnalyticsObject"] = r;
        ((i[r] =
          i[r] ||
          function () {
            (i[r].q = i[r].q || []).push(arguments);
          }),
          (i[r].l = 1 * new Date()));
        ((a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]));
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      })(
        window,
        document,
        "script",
        "https://www.google-analytics.com/analytics.js",
        "ga",
      );
      ga("create", "UA-83598394-1", "auto");
      ga("send", "pageview");
    </script>
    {% if admin %}
    <script>
      (function () {
        const dayEl = document.getElementById("day");
        if (!dayEl) return;

        let last = dayEl.innerHTML;
        let ignoreNext = false;

        function onDayChanged(newText, oldText) {
          // if we would set the same content, do nothing
          let wanted;
          if (newText.includes("Admin")) {
            wanted = newText;
          } else {
            wanted = newText + '<span style="color: lightblue;"> Admin</span>';
          }
          if (dayEl.innerHTML === wanted) return;

          // mark that the next mutation is from us
          ignoreNext = true;
          try {
            dayEl.innerHTML = wanted;
          } finally {
            // leave ignoreNext true until the observer clears it on the next callback
          }
        }

        const observer = new MutationObserver(() => {
          if (ignoreNext) {
            // skip the mutation caused by onDayChanged
            ignoreNext = false;
            last = dayEl.innerHTML; // keep last in sync
            return;
          }
          const current = dayEl.innerHTML;
          if (current !== last) {
            const prev = last;
            last = current;
            try {
              onDayChanged(current, prev);
            } catch (err) {
              console.error(err);
            }
          }
        });

        observer.observe(dayEl, {
          characterData: true,
          childList: true,
          subtree: true,
        });
      })();
    </script>
    {% endif %}
  </body>
</html>
